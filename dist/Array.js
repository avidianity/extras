"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.except = except;
exports.only = only;

var _lodash = require("lodash");

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var errors = [];

if (typeof Array.prototype.random === 'undefined') {
  Object.defineProperty(Array.prototype, 'random', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value() {
      return this[Math.floor(Math.random() * this.length)];
    }
  });
} else {
  errors.push('random');
}

if (typeof Array.prototype.limit === 'undefined') {
  Object.defineProperty(Array.prototype, 'limit', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value(length) {
      if (this.length > length) {
        this.length = length;
      }

      return this;
    }
  });
} else {
  errors.push('limit');
}

if (typeof Array.prototype.first === 'undefined') {
  Object.defineProperty(Array.prototype, 'first', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value() {
      if (this.length > 0) {
        return this[0];
      }

      return null;
    }
  });
} else {
  errors.push('first');
}

if (typeof Array.prototype.last === 'undefined') {
  Object.defineProperty(Array.prototype, 'last', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value() {
      if (this.length > 0) {
        return this[this.length - 1];
      }

      return null;
    }
  });
} else {
  errors.push('last');
}

if (typeof Array.prototype.flatten === 'undefined') {
  Object.defineProperty(Array.prototype, 'flatten', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value() {
      return (0, _lodash.flattenDeep)(this);
    }
  });
} else {
  errors.push('flatten');
}

if (typeof Array.prototype.groupBy === 'undefined') {
  Object.defineProperty(Array.prototype, 'groupBy', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value(key) {
      var temp = {};
      this.forEach(function (item) {
        var property = item[key];

        if (!(property in temp)) {
          temp[property] = [];
        }

        temp[property].push(item);
      });
      return Object.keys(temp).map(function (key) {
        return temp[key];
      });
    }
  });
} else {
  errors.push('groupBy');
}

function except(item, keys) {
  var copy = {};

  for (var _key in item) {
    if (!keys.includes(_key)) {
      copy[_key] = item[_key];
    }
  }

  return copy;
}

function only(item, keys) {
  var copy = {};

  for (var _key2 in item) {
    if (keys.includes(_key2)) {
      copy[_key2] = item[_key2];
    }
  }

  return copy;
}

if (typeof Array.prototype.except === 'undefined') {
  Object.defineProperty(Array.prototype, 'except', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value(keys) {
      return _toConsumableArray(this).map(function (item) {
        return except(item, keys);
      });
    }
  });
} else {
  errors.push('except');
}

if (typeof Array.prototype.only === 'undefined') {
  Object.defineProperty(Array.prototype, 'only', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value(keys) {
      return _toConsumableArray(this).map(function (item) {
        return only(item, keys);
      });
    }
  });
} else {
  errors.push('only');
}

if (typeof Array.prototype.has === 'undefined') {
  Object.defineProperty(Array.prototype, 'has', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value(predicate) {
      for (var _key3 in this) {
        var _item = this[_key3];

        if (predicate(_item, _key3, this)) {
          return true;
        }
      }

      return false;
    }
  });
} else {
  errors.push('has');
}

if (errors.length > 0) {
  console.error("@avidian/extras:Array: Unable to patch the following methods - ".concat(errors.join(', ')));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BcnJheS50cyJdLCJuYW1lcyI6WyJlcnJvcnMiLCJBcnJheSIsInByb3RvdHlwZSIsInJhbmRvbSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwidmFsdWUiLCJNYXRoIiwiZmxvb3IiLCJsZW5ndGgiLCJwdXNoIiwibGltaXQiLCJmaXJzdCIsImxhc3QiLCJmbGF0dGVuIiwiZ3JvdXBCeSIsImtleSIsInRlbXAiLCJmb3JFYWNoIiwiaXRlbSIsInByb3BlcnR5Iiwia2V5cyIsIm1hcCIsImV4Y2VwdCIsImNvcHkiLCJpbmNsdWRlcyIsIm9ubHkiLCJoYXMiLCJwcmVkaWNhdGUiLCJjb25zb2xlIiwiZXJyb3IiLCJqb2luIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7OztBQWdCQSxJQUFNQSxNQUFnQixHQUFHLEVBQXpCOztBQUVBLElBQUksT0FBT0MsS0FBSyxDQUFDQyxTQUFOLENBQWdCQyxNQUF2QixLQUFrQyxXQUF0QyxFQUFtRDtBQUMvQ0MsRUFBQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCSixLQUFLLENBQUNDLFNBQTVCLEVBQXVDLFFBQXZDLEVBQWlEO0FBQzdDSSxJQUFBQSxVQUFVLEVBQUUsS0FEaUM7QUFFN0NDLElBQUFBLFlBQVksRUFBRSxLQUYrQjtBQUc3Q0MsSUFBQUEsUUFBUSxFQUFFLEtBSG1DO0FBSTdDQyxJQUFBQSxLQUFLLEVBQUUsaUJBQVk7QUFDZixhQUFPLEtBQUtDLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNQLE1BQUwsS0FBZ0IsS0FBS1MsTUFBaEMsQ0FBTCxDQUFQO0FBQ0g7QUFONEMsR0FBakQ7QUFRSCxDQVRELE1BU087QUFDSFosRUFBQUEsTUFBTSxDQUFDYSxJQUFQLENBQVksUUFBWjtBQUNIOztBQUVELElBQUksT0FBT1osS0FBSyxDQUFDQyxTQUFOLENBQWdCWSxLQUF2QixLQUFpQyxXQUFy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QWtCTyxJQUFJLENBQUNQLElBQUQsRUFBT0UsSUFBUCxDQUF0QjtBQUFBLE9BQWQsQ0FBUDtBQUNIO0FBTjBDLEdBQS9DO0FBUUgsQ0FURCxNQVNPO0FBQ0h4QixFQUFBQSxNQUFNLENBQUNhLElBQVAsQ0FBWSxNQUFaO0FBQ0g7O0FBRUQsSUFBSSxPQUFPWixLQUFLLENBQUNDLFNBQU4sQ0FBZ0I0QixHQUF2QixLQUErQixXQUFuQyxFQUFnRDtBQUM1QzFCLEVBQUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkosS0FBSyxDQUFDQyxTQUE1QixFQUF1QyxLQUF2QyxFQUE4QztBQUMxQ0ksSUFBQUEsVUFBVSxFQUFFLEtBRDhCO0FBRTFDQyxJQUFBQSxZQUFZLEVBQUUsS0FGNEI7QUFHMUNDLElBQUFBLFFBQVEsRUFBRSxLQUhnQztBQUkxQ0MsSUFBQUEsS0FBSyxFQUFFLGVBQWFzQixTQUFiLEVBQTJFO0FBQzlFLFdBQUssSUFBTVosS0FBWCxJQUFrQixJQUFsQixFQUF3QjtBQUNwQixZQUFNRyxLQUFJLEdBQUcsS0FBS0gsS0FBTCxDQUFiOztBQUNBLFlBQUlZLFNBQVMsQ0FBQ1QsS0FBRCxFQUFPSCxLQUFQLEVBQW1CLElBQW5CLENBQWIsRUFBdUM7QUFDbkMsaUJBQU8sSUFBUDtBQUNIO0FBQ0o7O0FBQ0QsYUFBTyxLQUFQO0FBQ0g7QUFaeUMsR0FBOUM7QUFjSCxDQWZELE1BZU87QUFDSG5CLEVBQUFBLE1BQU0sQ0FBQ2EsSUFBUCxDQUFZLEtBQVo7QUFDSDs7QUFFRCxJQUFJYixNQUFNLENBQUNZLE1BQVAsR0FBZ0IsQ0FBcEIsRUFBdUI7QUFDbkJvQixFQUFBQSxPQUFPLENBQUNDLEtBQVIsMEVBQWdGakMsTUFBTSxDQUFDa0MsSUFBUCxDQUFZLElBQVosQ0FBaEY7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZsYXR0ZW5EZWVwIH0gZnJvbSAnbG9kYXNoJztcblxuZGVjbGFyZSBnbG9iYWwge1xuICAgIGludGVyZmFjZSBBcnJheTxUPiB7XG4gICAgICAgIHJhbmRvbSgpOiBUO1xuICAgICAgICBmaXJzdCgpOiBUIHwgbnVsbDtcbiAgICAgICAgbGFzdCgpOiBUIHwgbnVsbDtcbiAgICAgICAgZmxhdHRlbigpOiBUW107XG4gICAgICAgIGdyb3VwQnk8SyBleHRlbmRzIGtleW9mIFQ+KGtleTogSyk6IFRbXVtdO1xuICAgICAgICBleGNlcHQ8SyBleHRlbmRzIGtleW9mIFQ+KGtleXM6IEtbXSk6IFRbXTtcbiAgICAgICAgb25seTxLIGV4dGVuZHMga2V5b2YgVD4oa2V5czogS1tdKTogVFtdO1xuICAgICAgICBoYXMocHJlZGljYXRlOiAoaXRlbTogVCwgaW5kZXg6IG51bWJlciwgdGhpc0FyZzogdGhpcykgPT4gYm9vbGVhbik6IGJvb2xlYW47XG4gICAgICAgIGxpbWl0KGxlbmd0aDogbnVtYmVyKTogdGhpcztcbiAgICB9XG59XG5cbmNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuaWYgKHR5cGVvZiBBcnJheS5wcm90b3R5cGUucmFuZG9tID09PSAndW5kZWZpbmVkJykge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsICdyYW5kb20nLCB7XG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmxlbmd0aCldO1xuICAgICAgICB9LFxuICAgIH0pO1xufSBlbHNlIHtcbiAgICBlcnJvcnMucHVzaCgncmFuZG9tJyk7XG59XG5cbmlmICh0eXBlb2YgQXJyYXkucHJvdG90eXBlLmxpbWl0ID09PSAndW5kZWZpbmVkJykge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsICdsaW1pdCcsIHtcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChsZW5ndGg6IG51bWJlcikge1xuICAgICAgICAgICAgaWYgKHRoaXMubGVuZ3RoID4gbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuICAgIH0pO1xufSBlbHNlIHtcbiAgICBlcnJvcnMucHVzaCgnbGltaXQnKTtcbn1cblxuaWYgKHR5cGVvZiBBcnJheS5wcm90b3R5cGUuZmlyc3QgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgJ2ZpcnN0Jywge1xuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0sXG4gICAgfSk7XG59IGVsc2Uge1xuICAgIGVycm9ycy5wdXNoKCdmaXJzdCcpO1xufVxuXG5pZiAodHlwZW9mIEFycmF5LnByb3RvdHlwZS5sYXN0ID09PSAndW5kZWZpbmVkJykge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsICdsYXN0Jywge1xuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW3RoaXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0gZWxzZSB7XG4gICAgZXJyb3JzLnB1c2goJ2xhc3QnKTtcbn1cblxuaWYgKHR5cGVvZiBBcnJheS5wcm90b3R5cGUuZmxhdHRlbiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCAnZmxhdHRlbicsIHtcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBmbGF0dGVuRGVlcCh0aGlzKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0gZWxzZSB7XG4gICAgZXJyb3JzLnB1c2goJ2ZsYXR0ZW4nKTtcbn1cblxuaWYgKHR5cGVvZiBBcnJheS5wcm90b3R5cGUuZ3JvdXBCeSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCAnZ3JvdXBCeScsIHtcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIDxULCBLIGV4dGVuZHMga2V5b2YgVD4oa2V5OiBLKSB7XG4gICAgICAgICAgICBjb25zdCB0ZW1wOiB7IFtrZXk6IHN0cmluZ106IEFycmF5PFQ+IH0gPSB7fTtcblxuICAgICAgICAgICAgdGhpcy5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eTogYW55ID0gaXRlbVtrZXldO1xuICAgICAgICAgICAgICAgIGlmICghKHByb3BlcnR5IGluIHRlbXApKSB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBbcHJvcGVydHldID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRlbXBbcHJvcGVydHldLnB1c2goaXRlbSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0ZW1wKS5tYXAoKGtleSkgPT4gdGVtcFtrZXldKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0gZWxzZSB7XG4gICAgZXJyb3JzLnB1c2goJ2dyb3VwQnknKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4Y2VwdDxULCBLIGV4dGVuZHMga2V5b2YgVD4oaXRlbTogVCwga2V5czogS1tdKSB7XG4gICAgY29uc3QgY29weTogYW55ID0ge307XG5cbiAgICBmb3IgKGNvbnN0IGtleSBpbiBpdGVtKSB7XG4gICAgICAgIGlmICgha2V5cy5pbmNsdWRlcyhrZXkgYXMgYW55KSkge1xuICAgICAgICAgICAgY29weVtrZXldID0gaXRlbVtrZXldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvcHk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvbmx5PFQsIEsgZXh0ZW5kcyBrZXlvZiBUPihpdGVtOiBULCBrZXlzOiBLW10pIHtcbiAgICBjb25zdCBjb3B5OiBhbnkgPSB7fTtcblxuICAgIGZvciAoY29uc3Qga2V5IGluIGl0ZW0pIHtcbiAgICAgICAgaWYgKGtleXMuaW5jbHVkZXMoa2V5IGFzIGFueSkpIHtcbiAgICAgICAgICAgIGNvcHlba2V5XSA9IGl0ZW1ba2V5XTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb3B5O1xufVxuXG5pZiAodHlwZW9mIEFycmF5LnByb3RvdHlwZS5leGNlcHQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgJ2V4Y2VwdCcsIHtcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIDxULCBLIGV4dGVuZHMga2V5b2YgVD4oa2V5czogS1tdKSB7XG4gICAgICAgICAgICByZXR1cm4gWy4uLnRoaXNdLm1hcCgoaXRlbTogb2JqZWN0KSA9PiBleGNlcHQoaXRlbSwga2V5cyBhcyBhbnkpKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0gZWxzZSB7XG4gICAgZXJyb3JzLnB1c2goJ2V4Y2VwdCcpO1xufVxuXG5pZiAodHlwZW9mIEFycmF5LnByb3RvdHlwZS5vbmx5ID09PSAndW5kZWZpbmVkJykge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsICdvbmx5Jywge1xuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gPFQsIEsgZXh0ZW5kcyBrZXlvZiBUPihrZXlzOiBLW10pIHtcbiAgICAgICAgICAgIHJldHVybiBbLi4udGhpc10ubWFwKChpdGVtOiBPYmplY3QpID0+IG9ubHkoaXRlbSwga2V5cyBhcyBhbnkpKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0gZWxzZSB7XG4gICAgZXJyb3JzLnB1c2goJ29ubHknKTtcbn1cblxuaWYgKHR5cGVvZiBBcnJheS5wcm90b3R5cGUuaGFzID09PSAndW5kZWZpbmVkJykge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsICdoYXMnLCB7XG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiA8VD4ocHJlZGljYXRlOiAoaXRlbTogVCwgaW5kZXg6IG51bWJlciwgdGhpc0FyZzogYW55KSA9PiBib29sZWFuKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXNba2V5XTtcbiAgICAgICAgICAgICAgICBpZiAocHJlZGljYXRlKGl0ZW0sIGtleSBhcyBhbnksIHRoaXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0gZWxzZSB7XG4gICAgZXJyb3JzLnB1c2goJ2hhcycpO1xufVxuXG5pZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zb2xlLmVycm9yKGBAYXZpZGlhbi9leHRyYXM6QXJyYXk6IFVuYWJsZSB0byBwYXRjaCB0aGUgZm9sbG93aW5nIG1ldGhvZHMgLSAke2Vycm9ycy5qb2luKCcsICcpfWApO1xufVxuXG5leHBvcnQge307XG4iXX0=